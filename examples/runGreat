#!/usr/bin/tcsh
# Script to run great3sims.run for a specific set of subfields with shear, filter, and seeing
if "$1" == "" then
    echo "usage: $0 base"
    exit(1)
endif
setenv base $1
if (! -d $base) then
    echo "No directory found: $base"
    exit(1)
endif
if (! -e $base/run_params) then
    echo "No run_params files in $base"
    exit(1)
endif

setenv base $1
setenv output_dir `grep output_dir $1/run_params | sed -e 's/.* //'`
setenv psf_dir `grep psf_dir $1/run_params | sed -e 's/.* //'`
if (! -d $base/$output_dir) then
    mkdir -p $base/$output_dir
    ln -s `readlink -f $psf_dir` $base/$output_dir/psfs
else
    touch $base/$output_dir/image
    rm $base/$output_dir/*image*
endif
setenv shear_value `grep shear_value $1/run_params | sed -e 's/.* //'`
setenv n_subfields `grep n_subfields $1/run_params | sed -e 's/.* //'`
setenv n_epochs `grep n_epochs $1/run_params | sed -e 's/.* //'`
setenv ndims `grep ndims $1/run_params | sed -e 's/.* //'`
setenv gal_dir `grep gal_dir $1/run_params | sed -e 's/.* //'`
setenv galaxy_stamp_size `grep galaxy_stamp_size $1/run_params | sed -e 's/.* //'`
setenv args "$base --shear_value=$shear_value --ndims=$ndims --n_subfields=$n_subfields --n_epochs=$n_epochs --gal_dir=$gal_dir --galaxy_stamp_size=$galaxy_stamp_size"
echo $args
python control.py $args
